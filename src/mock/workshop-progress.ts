import type {
  WorkshopProgressDataset,
  WorkshopProgressOrder,
  WorkshopStageProgress,
} from '../types';

const createStage = (
  key: WorkshopStageProgress['key'],
  label: string,
  completed: number,
  total: number,
  status: WorkshopStageProgress['status'],
): WorkshopStageProgress => ({
  key,
  label,
  completed,
  total,
  status,
});

const orders: WorkshopProgressOrder[] = [
  {
    id: 'wp-CT0056-2-6',
    orderNo: 'CT0056-2-6',
    styleNo: 'CT0056',
    styleName: '成人防风夹克',
    customer: '本厂',
    bedNo: '6',
    remark: '优先排产，客户加急',
    colorSizeSummary: '黑色/灰色 S-XL，共 740 件',
    orderDate: '2025-09-04',
    deliveryDate: '2025-09-18',
    thumbnail: 'https://dummyimage.com/64x64/1677ff/ffffff&text=CT',
    orderQuantity: 740,
    cuttingQuantity: 774,
    status: 'in_progress',
    statusLabel: '进行中',
    stages: [
      createStage('cutting', '裁床', 774, 774, 'completed'),
      createStage('sewing', '车缝', 512, 774, 'in_progress'),
      createStage('finishing', '后整', 206, 774, 'in_progress'),
      createStage('packaging', '包装', 128, 774, 'in_progress'),
      createStage('warehousing', '入库', 0, 774, 'not_started'),
    ],
  },
  {
    id: 'wp-ET5025-1',
    orderNo: '202509170005',
    styleNo: 'ET5025',
    styleName: '童装拉链套装',
    customer: '鸿铭服饰',
    bedNo: '1',
    remark: '需要分批交付',
    colorSizeSummary: '粉/蓝/黑 110-150，共 960 件',
    orderDate: '2025-09-17',
    deliveryDate: '2025-09-28',
    thumbnail: 'https://dummyimage.com/64x64/fa8c16/ffffff&text=ET',
    orderQuantity: 960,
    cuttingQuantity: 960,
    status: 'delayed',
    statusLabel: '预警',
    stages: [
      createStage('cutting', '裁床', 960, 960, 'completed'),
      createStage('sewing', '车缝', 286, 960, 'delayed'),
      createStage('finishing', '后整', 120, 960, 'in_progress'),
      createStage('packaging', '包装', 60, 960, 'not_started'),
      createStage('warehousing', '入库', 0, 960, 'not_started'),
    ],
  },
  {
    id: 'wp-ET0070-83',
    orderNo: 'ET0070-83/89',
    styleNo: 'ET0070',
    styleName: '童装连帽卫衣',
    customer: '睿宗李总',
    bedNo: '8',
    remark: '车缝班组 B',
    colorSizeSummary: '橘/湖蓝 120-150，共 1,900 件',
    orderDate: '2025-08-22',
    deliveryDate: '2025-09-18',
    thumbnail: 'https://dummyimage.com/64x64/13c2c2/ffffff&text=ET',
    orderQuantity: 1900,
    cuttingQuantity: 1908,
    status: 'in_progress',
    statusLabel: '进行中',
    stages: [
      createStage('cutting', '裁床', 1908, 1908, 'completed'),
      createStage('sewing', '车缝', 1148, 1908, 'in_progress'),
      createStage('finishing', '后整', 640, 1908, 'in_progress'),
      createStage('packaging', '包装', 420, 1908, 'in_progress'),
      createStage('warehousing', '入库', 180, 1908, 'in_progress'),
    ],
  },
  {
    id: 'wp-ET0297-0304',
    orderNo: 'ET0297-03/04',
    styleNo: 'ET0297',
    styleName: '男童拼接短袖套装',
    customer: '石狮',
    bedNo: '12',
    remark: '等待后整排期',
    colorSizeSummary: '蓝色/米色 110-160，共 225 件',
    orderDate: '2025-09-11',
    deliveryDate: '2025-09-25',
    thumbnail: 'https://dummyimage.com/64x64/9254de/ffffff&text=ET',
    orderQuantity: 225,
    cuttingQuantity: 225,
    status: 'new',
    statusLabel: '新单',
    stages: [
      createStage('cutting', '裁床', 120, 225, 'in_progress'),
      createStage('sewing', '车缝', 0, 225, 'not_started'),
      createStage('finishing', '后整', 0, 225, 'not_started'),
      createStage('packaging', '包装', 0, 225, 'not_started'),
      createStage('warehousing', '入库', 0, 225, 'not_started'),
    ],
  },
  {
    id: 'wp-ET0107-hm',
    orderNo: 'ET0107-鸿铭',
    styleNo: 'ET0107',
    styleName: '儿童三层棉衣',
    customer: '鸿铭服饰',
    bedNo: '2',
    remark: '锁眼机待维修',
    colorSizeSummary: '黑/红 110-150，共 250 件',
    orderDate: '2025-09-22',
    deliveryDate: '2025-09-29',
    thumbnail: 'https://dummyimage.com/64x64/ff7875/ffffff&text=ET',
    orderQuantity: 250,
    cuttingQuantity: 240,
    status: 'in_progress',
    statusLabel: '进行中',
    stages: [
      createStage('cutting', '裁床', 240, 240, 'completed'),
      createStage('sewing', '车缝', 128, 240, 'in_progress'),
      createStage('finishing', '后整', 40, 240, 'delayed'),
      createStage('packaging', '包装', 0, 240, 'not_started'),
      createStage('warehousing', '入库', 0, 240, 'not_started'),
    ],
  },
  {
    id: 'wp-CT0298-hq',
    orderNo: 'CT0298总部',
    styleNo: 'CT0298',
    styleName: '成人迷彩加绒外套',
    customer: '总部大货',
    bedNo: '15',
    remark: '包装需加人手',
    colorSizeSummary: '迷彩 L-3XL，共 1,240 件',
    orderDate: '2025-08-09',
    deliveryDate: '2025-09-15',
    thumbnail: 'https://dummyimage.com/64x64/2f54eb/ffffff&text=CT',
    orderQuantity: 1240,
    cuttingQuantity: 1118,
    status: 'completed',
    statusLabel: '已完成',
    stages: [
      createStage('cutting', '裁床', 1118, 1118, 'completed'),
      createStage('sewing', '车缝', 1118, 1118, 'completed'),
      createStage('finishing', '后整', 1118, 1118, 'completed'),
      createStage('packaging', '包装', 1118, 1118, 'completed'),
      createStage('warehousing', '入库', 1118, 1118, 'completed'),
    ],
  },
];

const dataset: WorkshopProgressDataset = {
  summary: {
    totalOrders: orders.length,
    delayedOrders: orders.filter((order) => order.status === 'delayed').length,
    completedOrders: orders.filter((order) => order.status === 'completed').length,
    inProductionOrders: orders.filter((order) => order.status === 'in_progress').length,
  },
  orders,
};

export const getWorkshopProgressDataset = (): WorkshopProgressDataset => dataset;

export const fetchWorkshopProgressDataset = (delay = 200): Promise<WorkshopProgressDataset> =>
  new Promise((resolve) => {
    setTimeout(() => resolve(dataset), delay);
  });
